# Git Secrets Configuration

This repository is protected by [git-secrets](https://github.com/awslabs/git-secrets) to prevent accidental commits of sensitive credentials.

## What is Git Secrets?

Git secrets scans commits, commit messages, and merges for secret information (i.e., access keys). If prohibited patterns are detected, the commit is rejected.

## Installation Status

✅ **Installed and Active**

Git hooks are installed at:
- `.git/hooks/pre-commit` - Scans staged changes before commit
- `.git/hooks/commit-msg` - Scans commit messages
- `.git/hooks/prepare-commit-msg` - Scans during commit preparation

## Protected Patterns

The following patterns are detected and blocked:

### AWS Credentials
- AWS Access Keys (AKIA*, ASIA*, etc.)
- AWS Secret Access Keys
- AWS Account IDs

### Database Credentials
- PostgreSQL connection strings with credentials
- Pattern: `DATABASE_URL=postgresql://...`

### Email/SMTP Credentials
- SMTP passwords: `SMTP_PASS=<value>`
- SMTP users with actual emails: `SMTP_USER=user@domain.com`
- Gmail App Passwords: `xxxx xxxx xxxx xxxx` format

### Generic Patterns
- Any `password=` assignment with 8+ characters

## Allowed Patterns (False Positive Prevention)

The following are explicitly allowed and won't trigger alerts:

- `<app_password_redacted>`
- `<secret>`
- `<YOUR_VALUE>`
- `password_123` (example dev password)
- `SMTP_USER=james@jamesschaffer.com` (documentation)
- `REPLACE_WITH_STRONG_PASSWORD` (placeholder text)
- `REPLACE_WITH_STRONG_APP_PASSWORD` (placeholder text)
- AWS example keys from official documentation

## Usage

### Automatic Protection
Git secrets runs automatically on every commit. If secrets are detected:

```bash
$ git commit -m "Add config"
[ERROR] Matched one or more prohibited patterns
```

The commit will be blocked until the secret is removed.

### Manual Scanning
Scan the entire repository:
```bash
git secrets --scan
```

Scan a specific file:
```bash
git secrets --scan path/to/file
```

Scan history for leaked secrets:
```bash
git secrets --scan-history
```

### Override (Use with Caution)
If you're absolutely certain a detection is a false positive:
```bash
git commit --no-verify -m "Message"
```

**Warning:** Only use `--no-verify` if you're 100% sure the flagged content is safe.

## Adding New Patterns

### Block a new pattern:
```bash
git secrets --add 'your-regex-pattern'
```

### Allow a false positive:
```bash
git secrets --add --allowed 'allowed-pattern'
```

### List current configuration:
```bash
git secrets --list
```

## For New Team Members

When cloning this repository, git-secrets hooks are NOT automatically installed. New contributors must run:

```bash
brew install git-secrets
git secrets --install
git secrets --register-aws
```

The custom patterns are stored in `.git/config` and won't be shared. To apply all custom patterns, run:

```bash
# AWS patterns
git secrets --register-aws

# Custom patterns
git secrets --add 'SMTP_PASS\s*=\s*[^\s<]+'
git secrets --add 'SMTP_USER\s*=\s*[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'
git secrets --add '[a-z]{4}\s[a-z]{4}\s[a-z]{4}\s[a-z]{4}'
git secrets --add 'DATABASE_URL\s*=\s*postgresql://[^<\s]+'
git secrets --add 'password\s*=\s*[^\s<][^\s]{8,}'

# Allowed patterns
git secrets --add --allowed '<app_password_redacted>'
git secrets --add --allowed '<secret>'
git secrets --add --allowed '<YOUR_VALUE>'
git secrets --add --allowed 'password_123'
git secrets --add --allowed 'your_sendgrid_api_key'
git secrets --add --allowed 'SMTP_USER=james@jamesschaffer.com'
git secrets --add --allowed 'REPLACE_WITH_STRONG_PASSWORD'
git secrets --add --allowed 'REPLACE_WITH_STRONG_APP_PASSWORD'
```

## Incident History

### November 25, 2025 - Gmail App Password Exposure
**Status:** Resolved

GitGuardian detected exposed Gmail App Password in commit `f900840`.

**Response:**
1. Password revoked at Google Account level
2. New App Password generated and stored in GCP Secret Manager
3. Credentials redacted from documentation
4. Git-secrets installed to prevent recurrence

**Commit:** `1138030` - Security: Redact exposed SMTP credentials

## Best Practices

1. **Never commit real credentials** - Use placeholders in documentation:
   - ✅ `SMTP_PASS=<your_app_password>`
   - ❌ `SMTP_PASS=abcd efgh ijkl mnop`

2. **Use environment variables** - Store credentials in:
   - Local: `.env` files (gitignored)
   - Production: GCP Secret Manager

3. **Use `.env.example`** - Provide templates with dummy values:
   ```bash
   DATABASE_URL=postgresql://user:password@localhost:5432/dbname
   SMTP_PASS=<your_gmail_app_password>
   ```

4. **Redact in documentation** - When writing guides:
   - Use `<secret>`, `***`, or `<YOUR_VALUE>` instead of real values
   - Never copy-paste from production configs

5. **Scan before sharing** - Before making repo public or sharing code:
   ```bash
   git secrets --scan-history
   ```

## Troubleshooting

### Hook not running
```bash
# Reinstall hooks
git secrets --install --force
```

### Too many false positives
Add allowed pattern:
```bash
git secrets --add --allowed 'your-safe-pattern'
```

### Remove git-secrets
```bash
git secrets --remove
```

## Resources

- [git-secrets GitHub](https://github.com/awslabs/git-secrets)
- [GitGuardian Documentation](https://docs.gitguardian.com/)
- [Google App Passwords](https://myaccount.google.com/apppasswords)
- [GCP Secret Manager](https://cloud.google.com/secret-manager/docs)

## Maintenance

Last updated: November 25, 2025
Maintained by: Development Team
Review frequency: Quarterly or after security incidents
